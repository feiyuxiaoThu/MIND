# MIND算法演示场景说明文档

本文档详细介绍了MIND算法的四个演示场景，包括场景配置、特点和应用场景。

## 目录
- [Demo 1: 城市驾驶场景](#demo-1-城市驾驶场景)
- [Demo 2: 郊区道路场景](#demo-2-郊区道路场景)
- [Demo 3: 高速公路场景](#demo-3-高速公路场景)
- [Demo 4: 复杂交叉口场景](#demo-4-复杂交叉口场景)
- [优化器性能对比](#优化器性能对比)
- [运行指南](#运行指南)

---

## Demo 1: 城市驾驶场景

### 基本信息
- **配置文件**: `configs/demo_1.json`
- **序列ID**: `24520ce8-038f-4e5e-a455-8c06877504ab`
- **目标速度**: 4 m/s
- **场景类型**: 城市道路
- **演示文件**: `tree/examples/demo_1_scenario.py`

### 场景特点
1. **低速度环境**: 目标速度4 m/s，适合城市拥堵或起步阶段
2. **多模态预测**: 包含3种主要行为模式
   - 模态1: 正常起步行驶 (概率40%)
   - 模态2: 谨慎起步，考虑行人 (概率35%)
   - 模态3: 遇到红灯停车 (概率25%)
3. **道路特征**: 
   - 限速4 m/s
   - 车道宽度3.5 m
   - 包含交通灯和行人过街设施

### 配置参数
```python
'aimt': {
    'max_depth': 5,
    'tar_dist_thres': 10.0,
    'tar_time_ahead': 5.0,
    'seg_length': 15.0,
    'seg_n_node': 10,
    'far_dist_thres': 10.0
}
'cost': {
    'safety': {'weight': 15.0, 'safety_distance': 3.0},
    'target': {'target_velocity': 4.0, 'weight': 5.0},
    'comfort': {'acceleration_weight': 2.0, 'steering_weight': 1.0}
}
```

### 适用场景
- 城市拥堵路段
- 信号灯路口
- 起步阶段
- 行人密集区域

---

## Demo 2: 郊区道路场景

### 基本信息
- **配置文件**: `configs/demo_2.json`
- **序列ID**: `f4eaa49a-74a1-4829-81b2-052a650878c3`
- **目标速度**: 8 m/s
- **场景类型**: 郊区道路
- **演示文件**: `tree/examples/demo_2_scenario.py`

### 场景特点
1. **中等速度环境**: 目标速度8 m/s，适合郊区或乡村道路
2. **复杂驾驶行为**: 包含3种典型驾驶模式
   - 模态1: 正常巡航 (概率40%)
   - 模态2: 超车场景 (概率35%)
   - 模态3: 遇到慢车减速 (概率25%)
3. **道路特征**:
   - 限速8 m/s
   - 双车道
   - 包含弯道和停车标志
   - 轻度交通密度

### 配置参数
```python
'cost': {
    'safety': {'weight': 12.0, 'safety_distance': 2.5},
    'target': {'target_velocity': 8.0, 'weight': 8.0},
    'comfort': {'acceleration_weight': 3.0, 'steering_weight': 2.0}
}
'constraints': {
    'state_upper_bound': [100000.0, 100000.0, 12.0, 10.0, 4.0, 0.2],
    'state_lower_bound': [-100000.0, -100000.0, 0.0, -10.0, -6.0, -0.2]
}
```

### 适用场景
- 郊区公路
- 乡村道路
- 中等密度交通路段
- 需要超车的场景

---

## Demo 3: 高速公路场景

### 基本信息
- **配置文件**: `configs/demo_3.json`
- **序列ID**: `08a8b0c9-f93f-4ade-bcaa-e5348aeca381`
- **目标速度**: 8 m/s
- **启用时间步**: 0.0 (立即开始)
- **场景类型**: 高速公路
- **演示文件**: `tree/examples/demo_3_scenario.py`

### 场景特点
1. **高速度环境**: 限速12 m/s，适合高速公路巡航
2. **复杂高速行为**: 包含3种高速驾驶模式
   - 模态1: 稳定巡航 (概率35%)
   - 模态2: 变道超车 (概率35%)
   - 模态3: 紧急制动 (概率30%)
3. **道路特征**:
   - 三车道高速公路
   - 包含上匝道、下匝道和隧道
   - 中等交通密度
   - 立即开始规划 (enable_timestep: 0.0)

### 配置参数
```python
'cost': {
    'safety': {'weight': 10.0, 'safety_distance': 2.0},
    'target': {'target_velocity': 8.0, 'weight': 10.0},
    'comfort': {'acceleration_weight': 1.5, 'steering_weight': 1.0}
}
'features': {
    'on_ramp': {'position': [40.0, -3.5], 'merge_length': 30.0},
    'off_ramp': {'position': [80.0, 3.5], 'exit_length': 20.0},
    'tunnel': {'start': 50.0, 'end': 70.0, 'height_limit': 4.5}
}
```

### 适用场景
- 高速公路巡航
- 匝道汇入/驶出
- 隧道通行
- 高速变道超车

---

## Demo 4: 复杂交叉口场景

### 基本信息
- **配置文件**: `configs/demo_4.json`
- **序列ID**: `624a047f-598b-4d2f-ba4b-27e6699896dc`
- **目标速度**: 8 m/s
- **场景类型**: 复杂交叉口
- **演示文件**: `tree/examples/demo_4_scenario.py`

### 场景特点
1. **高度复杂环境**: 最具挑战性的城市驾驶场景
2. **多模态决策**: 包含4种通过交叉口的方式
   - 模态1: 直行通过 (概率30%)
   - 模态2: 左转通过 (概率25%)
   - 模态3: 遇到行人紧急制动 (概率25%)
   - 模态4: 右转通过 (概率20%)
3. **道路特征**:
   - 信号化复杂交叉口
   - 多方向交通流
   - 行人过街
   - 周围车辆交互

### 配置参数
```python
'aimt': {
    'max_depth': 6,  # 更深的搜索用于复杂场景
    'tar_dist_thres': 10.0,
    'tar_time_ahead': 5.0,
    'seg_length': 15.0,
    'seg_n_node': 10,
    'far_dist_thres': 10.0
}
'cost': {
    'safety': {'weight': 20.0, 'safety_distance': 3.0},  # 更高的安全权重
    'target': {'target_velocity': 8.0, 'weight': 8.0},
    'comfort': {'acceleration_weight': 2.5, 'steering_weight': 1.5}
}
```

### 交通参与者
- **行人**: 3个，包含等待和过街状态
- **周围车辆**: 3个，来自不同方向
- **交通灯**: 黄灯状态，3秒后变化
- **人行横道**: 4条，部分激活

### 适用场景
- 城市复杂交叉口
- 多方向交通流
- 行人密集区域
- 信号灯控制路口

---

## 优化器性能对比

每个演示场景都支持三种优化器，性能特点如下：

### iLQR优化器
- **优点**: 收敛性好，适合平滑轨迹
- **缺点**: 对初始值敏感，计算复杂度高
- **适用**: 轨迹平滑度要求高的场景

### MPC优化器
- **优点**: 实时性好，处理约束能力强
- **缺点**: 预测视野有限
- **适用**: 实时性要求高的场景

### CBF优化器
- **优点**: 安全保证强，支持QP求解
- **缺点**: 可能保守，计算时间变化大
- **适用**: 安全要求高的场景

### 性能测试结果
每个场景运行时会自动测试三种优化器的性能，包括：
- 计算耗时
- 成功状态
- 输出控制指令

---

## 运行指南

### 环境准备
```bash
# 激活虚拟环境
source mind_env/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 运行单个场景
```bash
# Demo 1 - 城市驾驶
python tree/examples/demo_1_scenario.py

# Demo 2 - 郊区道路
python tree/examples/demo_2_scenario.py

# Demo 3 - 高速公路
python tree/examples/demo_3_scenario.py

# Demo 4 - 复杂交叉口
python tree/examples/demo_4_scenario.py
```

### 输出文件
运行后生成的可视化图片保存在 `tree/plot/` 目录：
- `demo_1_scenario.png` - 城市驾驶场景可视化
- `demo_2_scenario.png` - 郊区道路场景可视化
- `demo_3_scenario.png` - 高速公路场景可视化
- `demo_4_scenario.png` - 复杂交叉口场景可视化

### 自定义场景
要创建自定义场景，可以：
1. 复制现有演示文件
2. 修改配置参数
3. 调整场景特征和预测模态
4. 更新道路数据和交通参与者

---

## 技术细节

### 状态空间
每个场景使用6维状态空间：
- x, y: 位置坐标
- v: 速度
- θ: 航向角
- a: 加速度
- δ: 转向角

### 控制空间
2维控制空间：
- da: 加速度变化率
- dδ: 转向角变化率

### 预测模态
每个场景包含多个预测模态，每个模态包括：
- 均值轨迹 (means)
- 协方差矩阵 (covariances)
- 出现概率 (probability)

### 成本函数
成本函数包含三个主要部分：
1. **安全性**: 与障碍物的安全距离
2. **目标跟踪**: 与目标轨迹的偏差
3. **舒适性**: 控制输入的平滑度

---

## 总结

这四个演示场景涵盖了从简单到复杂的各种驾驶环境，展示了MIND算法在不同场景下的适应性和鲁棒性：

1. **Demo 1** 展示了低速城市环境的基本功能
2. **Demo 2** 展示了中等速度下的复杂驾驶行为
3. **Demo 3** 展示了高速公路环境的高速决策能力
4. **Demo 4** 展示了极端复杂场景下的综合决策能力

通过这些演示，用户可以全面了解MIND算法的特点和优势，并根据实际需求选择合适的配置参数。